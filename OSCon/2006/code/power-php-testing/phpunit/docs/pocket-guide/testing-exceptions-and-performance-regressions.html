<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title>Chapter 6. Testing Exceptions and Performance Regressions</title><link rel="stylesheet" href="docbook.css" type="text/css"></link><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"></meta><link rel="start" href="index.html" title="PHPUnit Pocket Guide"></link><link rel="up" href="index.html" title="PHPUnit Pocket Guide"></link><link rel="prev" href="fixtures.html" title="Chapter 5. Fixtures"></link><link rel="next" href="incomplete-tests.html" title="Chapter 7. Incomplete Tests"></link><script xmlns="" src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script xmlns="" type="text/javascript">_uacct = "UA-68261-2";urchinTracker();</script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 6. Testing Exceptions and Performance Regressions</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="fixtures.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="incomplete-tests.html">Next</a></td></tr></table><hr></hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="testing-exceptions-and-performance-regressions"></a>Chapter 6. Testing Exceptions and Performance Regressions</h2></div></div></div><p>
    PHPUnit provides two extensions to the standard base-class for test
    classes, <code class="literal">PHPUnit2_Framework_TestCase</code>, that aid in the
    writing of tests for exceptions and performance regressions.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="testing-exceptions-and-performance-regressions.exceptions"></a>Exceptions</h2></div></div></div><p>
      How do you test exceptions? You cannot directly assert that they are
      raised. Instead you have to use PHP's exception handling facilities to
      write the test. The following example demonstrates testing exceptions:
    </p><pre class="programlisting"><code><span style="color: #113d73;">&lt;?php</span><br /><span style="color: #005500;">require_once</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'PHPUnit2/Framework/TestCase.php'</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #005500;">class</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">ExceptionTest</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">extends</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">PHPUnit2_Framework_TestCase</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">testException</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">try</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #ba8370;">//&nbsp;...&nbsp;Code&nbsp;that&nbsp;is&nbsp;expected&nbsp;to&nbsp;raise&nbsp;an&nbsp;Exception&nbsp;...</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">fail</span><span style="color: #005500;">(</span><span style="color: #550000;">'No&nbsp;Exception&nbsp;has&nbsp;been&nbsp;raised.'</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">catch</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">(</span><span style="color: #113d73;">Exception</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$expected</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #005500;">}</span><br /><span style="color: #113d73;">?&gt;</span><br /></code></pre><p>
      If the code that is expected to raise an exception does not raise an
      exception, the subsequent call to <code class="literal">fail()</code>
      (see <a href="api.html#api.assert.tables.bottleneck-methods" title="Table 14.2. Bottleneck Methods">Table 14.2</a>)
      will halt the test and signal a problem with the test. If the expected
      exception is raised, the <code class="literal">catch</code> block will be executed,
      and the test will continue executing.
    </p><p>
      <a id="id397593" class="indexterm"></a>

      Alternatively, you can extend your test class from
      <code class="literal">PHPUnit2_Extensions_ExceptionTestCase</code> to test whether
      an exception is thrown inside the tested code.
      <a href="testing-exceptions-and-performance-regressions.html#testing-exceptions-and-performance-regressions.exceptions.examples.ExceptionTest2.php" title="Example 6.1: Using PHPUnit2_Extensions_ExceptionTestCase">Example 6.1</a>
      shows how to subclass <code class="literal">PHPUnit2_Extensions_ExceptionTestCase</code>
      and use its <code class="literal">setExpectedException()</code> method to set the
      expected exception. If this expected exception is not thrown, the test
      will be counted as a failure.
    </p><div class="example"><a id="testing-exceptions-and-performance-regressions.exceptions.examples.ExceptionTest2.php"></a><p class="title"><b>Example 6.1: Using PHPUnit2_Extensions_ExceptionTestCase</b></p><pre class="programlisting"><code><span style="color: #113d73;">&lt;?php</span><br /><span style="color: #005500;">require_once</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'PHPUnit2/Extensions/ExceptionTestCase.php'</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #005500;">class</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">ExceptionTest</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">extends</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">PHPUnit2_Extensions_ExceptionTestCase</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">testException</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">setExpectedException</span><span style="color: #005500;">(</span><span style="color: #550000;">'Exception'</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #005500;">}</span><br /><span style="color: #113d73;">?&gt;</span><br /></code></pre><pre class="screen"><strong class="userinput"><code>phpunit ExceptionTest</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

F

Time: 0.006798
There was 1 failure:
1) testException(ExceptionTest)
Expected exception Exception

FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0, Incomplete Tests: 0.</pre></div><p>
      <a href="testing-exceptions-and-performance-regressions.html#testing-exceptions-and-performance-regressions.exceptions.tables.external-protocols" title="Table 6.1. ExceptionTestCase external protocols">Table 6.1</a>
      shows the external protocol implemented by
      <code class="literal">PHPUnit2_Extensions_ExceptionTestCase</code>.
    </p><div class="table"><a id="testing-exceptions-and-performance-regressions.exceptions.tables.external-protocols"></a><p class="title"><b>Table 6.1. ExceptionTestCase external protocols</b></p><table summary="ExceptionTestCase external protocols" border="1"><colgroup><col></col><col></col></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">void setExpectedException(String $exceptionName)</code></td><td align="left">Set the name of the expected exception to <code class="literal">$exceptionName</code>.</td></tr><tr><td align="left"><code class="literal">String getExpectedException()</code></td><td align="left">Return the name of the expected exception.</td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="testing-exceptions-and-performance-regressions.performance-regressions"></a>Performance Regressions</h2></div></div></div><p>
      <a id="id399374" class="indexterm"></a>

      You can extend your test class from <code class="literal">PHPUnit2_Extensions_PerformanceTestCase</code>
      to test whether the execution of a function or method call, for
      instance, exceeds a specified time limit.
    </p><p>
      <a href="testing-exceptions-and-performance-regressions.html#testing-exceptions-and-performance-regressions.performance-regressions.examples.PerformanceTest.php" title="Example 6.2: Using PHPUnit2_Extensions_PerformanceTestCase">Example 6.2</a>
      shows how to subclass <code class="literal">PHPUnit2_Extensions_PerformanceTestCase</code>
      and use its <code class="literal">setMaxRunningTime()</code> method to set the
      maximum running time for the test. If the test is not executed within
      this time limit, it will be counted as a failure.
    </p><div class="example"><a id="testing-exceptions-and-performance-regressions.performance-regressions.examples.PerformanceTest.php"></a><p class="title"><b>Example 6.2: Using PHPUnit2_Extensions_PerformanceTestCase</b></p><pre class="programlisting"><code><span style="color: #113d73;">&lt;?php</span><br /><span style="color: #005500;">require_once</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'PHPUnit2/Extensions/PerformanceTestCase.php'</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #005500;">class</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">PerformanceTest</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">extends</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">PHPUnit2_Extensions_PerformanceTestCase</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">testPerformance</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">setMaxRunningTime</span><span style="color: #005500;">(</span><span style="color: #113d73;">2</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">sleep</span><span style="color: #005500;">(</span><span style="color: #113d73;">1</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #005500;">}</span><br /><span style="color: #113d73;">?&gt;</span><br /></code></pre></div><p>
      <a href="testing-exceptions-and-performance-regressions.html#testing-exceptions-and-performance-regressions.performance-regressions.tables.external-protocols" title="Table 6.2. ExceptionTestCase external protocols">Table 6.2</a>
      shows the external protocol implemented by
      <code class="literal">PHPUnit2_Extensions_PerformanceTestCase</code>.
    </p><div class="table"><a id="testing-exceptions-and-performance-regressions.performance-regressions.tables.external-protocols"></a><p class="title"><b>Table 6.2. ExceptionTestCase external protocols</b></p><table summary="ExceptionTestCase external protocols" border="1"><colgroup><col></col><col></col></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">void setMaxRunningTime(integer $maxRunningTime)</code></td><td align="left">Set the maximum running time for the test to <code class="literal">$maxRunningTime</code> (in seconds).</td></tr><tr><td align="left"><code class="literal">integer getMaxRunningTime()</code></td><td align="left">Return the maximum running time allowed for the test.</td></tr></tbody></table></div></div></div><div class="navfooter"><hr></hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="fixtures.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="incomplete-tests.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 5. Fixtures </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 7. Incomplete Tests</td></tr></table></div><div xmlns="" class="copyright-notice"><a href="appendixes.copyright.html">Copyright</a> © 2005 <a href="http://www.sebastian-bergmann.de/">Sebastian Bergmann</a>
      and <a href="http://www.oreilly.com/">O'Reilly Media, Inc.</a>.
    </div></body></html>

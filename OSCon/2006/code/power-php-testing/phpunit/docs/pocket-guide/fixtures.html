<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title>Chapter 5. Fixtures</title><link rel="stylesheet" href="docbook.css" type="text/css"></link><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"></meta><link rel="start" href="index.html" title="PHPUnit Pocket Guide"></link><link rel="up" href="index.html" title="PHPUnit Pocket Guide"></link><link rel="prev" href="textui.html" title="Chapter 4. The Command-Line Test Runner"></link><link rel="next" href="testing-exceptions-and-performance-regressions.html" title="Chapter 6. Testing Exceptions and Performance Regressions"></link><script xmlns="" src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script xmlns="" type="text/javascript">_uacct = "UA-68261-2";urchinTracker();</script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 5. Fixtures</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="textui.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="testing-exceptions-and-performance-regressions.html">Next</a></td></tr></table><hr></hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="fixtures"></a>Chapter 5. Fixtures</h2></div></div></div><p>
    <a id="id343875" class="indexterm"></a>

    One of the most time-consuming parts of writing tests is writing the
    code to set the world up in a known state and then return it to its
    original state when the test is complete. This known state is called
    the <span class="emphasis"><em>fixture</em></span> of the test.
  </p><p>
    In <a href="goals.html#goals.examples.ArrayTest.php" title="Example 2.1: Testing Array and sizeof() with PHPUnit">Example 2.1</a>, the fixture
    was simply the array that is stored in the <code class="literal">$fixture</code>
    variable. Most of the time, though, the fixture will be more complex
    than a simple array, and the amount of code needed to set it up will
    grow accordingly. The actual content of the test gets lost in the noise
    of setting up the fixture. This problem gets even worse when you write
    several tests with similar fixtures. Without some help from the testing
    framework, we would have to duplicate the code that sets up the fixture
    for each test we write.
  </p><p>
    <a id="id343957" class="indexterm"></a>
    <a id="id343965" class="indexterm"></a>
    <a id="id343972" class="indexterm"></a>

    PHPUnit supports sharing the setup code. Before a test method is run, a
    template method called <code class="literal">setUp()</code> is invoked.
    <code class="literal">setUp()</code> is where you create the objects against which
    you will test. Once the test method has finished running, whether it
    succeeded or failed, another template method called
    <code class="literal">tearDown()</code> is invoked. <code class="literal">tearDown()</code>
    is where you clean up the objects against which you tested.
  </p><p>
    We can now refactor <a href="goals.html#goals.examples.ArrayTest.php" title="Example 2.1: Testing Array and sizeof() with PHPUnit">Example 2.1</a> and
    use <code class="literal">setUp()</code> to eliminate the code duplication that
    we had before. First we declare the instance variable,
    <code class="literal">$fixture</code>, that we are going to use instead of a
    method-local variable. Then we put the creation of the
    <code class="literal">Array</code> fixture into the <code class="literal">setUp()</code>
    method. Finally, we remove the redundant code from the test methods and
    use the newly introduced instance variable,
    <code class="literal">$this-&gt;fixture</code>, instead of the method-local variable
    <code class="literal">$fixture</code> with the <code class="literal">assertEquals()</code>
    assertion method.
  </p><div class="example"><a id="fixtures.examples.ArrayTest.php"></a><p class="title"><b>Example 5.1: Using setUp() to create the Array fixture</b></p><pre class="programlisting"><code><span style="color: #113d73;">&lt;?php</span><br /><span style="color: #005500;">require_once</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'PHPUnit2/Framework/TestCase.php'</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #005500;">class</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">ArrayTest</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">extends</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">PHPUnit2_Framework_TestCase</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">protected</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$fixture</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">protected</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">setUp</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #ba8370;">//&nbsp;Create&nbsp;the&nbsp;Array&nbsp;fixture.</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">fixture</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">Array</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">testNewArrayIsEmpty</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #ba8370;">//&nbsp;Assert&nbsp;that&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;Array&nbsp;fixture&nbsp;is&nbsp;0.</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">assertEquals</span><span style="color: #005500;">(</span><span style="color: #113d73;">0</span><span style="color: #005500;">,</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">sizeof</span><span style="color: #005500;">(</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">fixture</span><span style="color: #005500;">)</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">testArrayContainsAnElement</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #ba8370;">//&nbsp;Add&nbsp;an&nbsp;element&nbsp;to&nbsp;the&nbsp;Array&nbsp;fixture.</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">fixture</span><span style="color: #005500;">[</span><span style="color: #005500;">]</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'Element'</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #ba8370;">//&nbsp;Assert&nbsp;that&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;Array&nbsp;fixture&nbsp;is&nbsp;1.</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">assertEquals</span><span style="color: #005500;">(</span><span style="color: #113d73;">1</span><span style="color: #005500;">,</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">sizeof</span><span style="color: #005500;">(</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">fixture</span><span style="color: #005500;">)</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #005500;">}</span><br /><span style="color: #113d73;">?&gt;</span><br /></code></pre></div><p>
    <code class="literal">setUp()</code> and <code class="literal">tearDown()</code> will be
    called once for each test method run. While it might seem frugal to
    only run these methods once for all the test methods in a test-case
    class, doing so would make it hard to write tests that are completely
    independent of each other.
  </p><p>
    Not only are <code class="literal">setUp()</code> and <code class="literal">tearDown()</code>
    run once for each test method, but the test methods are run in fresh
    instances of the test-case class (see <a href="implementation.html" title="Chapter 13. PHPUnit's Implementation">Chapter 13</a>).
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="fixtures.more-setup-than-teardown"></a>More setUp() than tearDown()</h2></div></div></div><p>
      <code class="literal">setUp()</code> and <code class="literal">tearDown()</code> are nicely
      symmetrical in theory but not in practice. In practice, you only need
      to implement <code class="literal">tearDown()</code> if you have allocated
      external resources like files or sockets in <code class="literal">setUp()</code>.
      If your <code class="literal">setUp()</code> just creates plain PHP objects, you
      can generally ignore <code class="literal">tearDown()</code>. However, if you
      create many objects in your <code class="literal">setUp()</code>, you might want
      to <code class="literal">unset()</code> the variables pointing to those objects
      in your <code class="literal">tearDown()</code> so they can be garbage collected.
      The garbage collection of test case objects in not predictable.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="fixtures.variations"></a>Variations</h2></div></div></div><p>
      What happens when you have two tests with slightly different setups?
      There are two possibilities:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          If the <code class="literal">setUp()</code> code differs only slightly, move
          the code that differs from the <code class="literal">setUp()</code> code to
          the test method.
        </p></li><li><p>
          If you really have a different <code class="literal">setUp()</code>, you need
          a different test-case class. Name the class after the difference in
          the setup.
        </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="fixtures.suite-level-setup"></a>Suite-Level Setup</h2></div></div></div><p>
      <a id="id398460" class="indexterm"></a>

      PHPUnit does not provide convenient support for suite-level setup. There
      are few good reasons to share fixtures between tests, but in most cases
      the need to share a fixture between tests stems from an unresolved
      design problem.
    </p><p>
      A good example of a fixture that makes sense to share across several
      tests is a database connection: you log into the database once and reuse
      the database connection instead of creating a new connection for each
      test. This makes your tests run faster. To do this, write your database
      tests in a test-case class named <code class="literal">DatabaseTests</code> and
      wrap the test suite in a <code class="literal">TestSetup</code> decorator object
      that overrides <code class="literal">setUp()</code> to open the database
      connection and <code class="literal">tearDown()</code> to close the connection, as
      shown in
      <a href="fixtures.html#fixtures.suite-level-setup.examples.DatabaseTestSetup.php" title="Example 5.2: Writing a suite-level setup decorator">Example 5.2</a>.
      You can run the tests from <code class="literal">DatabaseTests</code> through the
      <code class="literal">DatabaseTestSetup</code> decorator by invoking, for instance,
      PHPUnit's command-line test runner with
      <strong class="userinput"><code>phpunit DatabaseTestSetup</code></strong>.
    </p><div class="example"><a id="fixtures.suite-level-setup.examples.DatabaseTestSetup.php"></a><p class="title"><b>Example 5.2: Writing a suite-level setup decorator</b></p><pre class="programlisting"><code><span style="color: #113d73;">&lt;?php</span><br /><span style="color: #005500;">require_once</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'PHPUnit2/Framework/TestSuite.php'</span><span style="color: #005500;">;</span><br /><span style="color: #005500;">require_once</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'PHPUnit2/Extensions/TestSetup.php'</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #005500;">class</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">DatabaseTestSetup</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">extends</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">PHPUnit2_Extensions_TestSetup</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">protected</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$connection</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">NULL</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">protected</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">setUp</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">connection</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">new</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">PDO</span><span style="color: #005500;">(</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #550000;">'mysql:host=wopr;dbname=test'</span><span style="color: #005500;">,</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #550000;">'root'</span><span style="color: #005500;">,</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #550000;">''</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">protected</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">tearDown</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">connection</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">NULL</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">static</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">suite</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">return</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">new</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">DatabaseTestSetup</span><span style="color: #005500;">(</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">new</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">PHPUnit2_Framework_TestSuite</span><span style="color: #005500;">(</span><span style="color: #550000;">'DatabaseTests'</span><span style="color: #005500;">)</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #005500;">}</span><br /><span style="color: #113d73;">?&gt;</span><br /></code></pre></div><p>
      It cannot be emphasized enough that sharing fixtures between tests
      reduces the value of the tests. The underlying design problem is
      that objects are too closely bound together. You will achieve better
      results solving the underlying design problem and then writing tests
      using stubs (see <a href="stubs.html" title="Chapter 10. Stubs">Chapter 10</a>), than by creating
      dependencies between tests at runtime and ignoring the opportunity
      to improve your design.
    </p></div></div><div class="navfooter"><hr></hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="textui.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="testing-exceptions-and-performance-regressions.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 4. The Command-Line Test Runner </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 6. Testing Exceptions and Performance Regressions</td></tr></table></div><div xmlns="" class="copyright-notice"><a href="appendixes.copyright.html">Copyright</a> © 2005 <a href="http://www.sebastian-bergmann.de/">Sebastian Bergmann</a>
      and <a href="http://www.oreilly.com/">O'Reilly Media, Inc.</a>.
    </div></body></html>

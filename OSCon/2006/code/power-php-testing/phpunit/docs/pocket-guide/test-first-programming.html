<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title>Chapter 8. Test-First Programming</title><link rel="stylesheet" href="docbook.css" type="text/css"></link><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"></meta><link rel="start" href="index.html" title="PHPUnit Pocket Guide"></link><link rel="up" href="index.html" title="PHPUnit Pocket Guide"></link><link rel="prev" href="incomplete-tests.html" title="Chapter 7. Incomplete Tests"></link><link rel="next" href="code-coverage-analysis.html" title="Chapter 9. Code-Coverage Analysis"></link><script xmlns="" src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script xmlns="" type="text/javascript">_uacct = "UA-68261-2";urchinTracker();</script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 8. Test-First Programming</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="incomplete-tests.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="code-coverage-analysis.html">Next</a></td></tr></table><hr></hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="test-first-programming"></a>Chapter 8. Test-First Programming</h2></div></div></div><p>
    <a id="id400070" class="indexterm"></a>
    <a id="id400078" class="indexterm"></a>
    <a id="id399908" class="indexterm"></a>
    <a id="id399915" class="indexterm"></a>
    <a id="id399923" class="indexterm"></a>

    Unit Tests are a vital part of several software development practices
    and processes such as Test-First Programming,
    <a href="http://en.wikipedia.org/wiki/Extreme_Programming" target="_top">Extreme Programming</a>,
    and <a href="http://en.wikipedia.org/wiki/Test-driven_development" target="_top">Test-Driven Development</a>.
    They also allow for <a href="http://en.wikipedia.org/wiki/Design_by_Contract" target="_top">Design-by-Contract</a>
    in programming languages that do not support this methodology with
    language constructs.
  </p><p>
    You can use PHPUnit to write tests once you are done programming.
    However, the sooner a test is written after an error has been introduced,
    the more valuable the test is. So instead of writing tests months after
    the code is "complete", we can write tests days or hours or minutes after
    the possible introduction of a defect. Why stop there? Why not write the
    tests a little before the possible introduction of a defect?
  </p><p>
    Test-First Programming, which is part of Extreme Programming and
    Test-Driven Development, builds upon this idea and takes it to the
    extreme. With today's computational power, we have the opportunity to
    run thousands of tests thousands of times per day. We can use the
    feedback from all of these tests to program in small steps, each of
    which carries with it the assurance of a new automated test in addition
    to all the tests that have come before. The tests are like pitons,
    assuring you that, no matter what happens, once you have made progress
    you can only fall so far.
  </p><p>
    When you first write the test it cannot possibly run, because you are
    calling on objects and methods that have not been programmed yet. This
    might feel strange at first, but after a while you will get used to it.
    Think of Test-First Programming as a pragmatic approach to following the
    object-oriented programming principle of programming to an interface
    instead of programming to an implementation: while you are writing the
    test you are thinking about the interface of the object you are
    testing -- what does this object look like from the outside. When you
    go to make the test really work, you are thinking about pure
    implementation. The interface is fixed by the failing test.
  </p><p>
    What follows is necessarily an abbreviated introduction to Test-First
    Programming. You can explore the topic further in other books, such as
    <span class="emphasis"><em>Test-Driven Development</em></span> [<a href="appendixes.bibliography.html#Beck2002" title="[Beck2002]"><span class="abbrev">Beck2002</span></a>]
    by Kent Beck or Dave Astels' <span class="emphasis"><em>A Practical Guide to Test-Driven
    Development</em></span> [<a href="appendixes.bibliography.html#Astels2003" title="[Astels2003]"><span class="abbrev">Astels2003</span></a>].
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="test-first-programming.bankaccount-example"></a>BankAccount Example</h2></div></div></div><p>
      In this chapter, we will look at the example of a class that represents
      a bank account. The contract for the <code class="literal">BankAccount</code>
      class not only requires methods to get and set the bank account's
      balance, as well as methods to deposit and withdraw money. It also
      specifies the following two conditions that must be ensured:
    </p><div class="itemizedlist"><ul type="disc"><li><p>The bank account's initial balance must be zero.</p></li><li><p>The bank account's balance cannot become negative.</p></li></ul></div><p>
      Following the Test-First Programming approach, we write the tests for
      the <code class="literal">BankAccount</code> class before we write the code for
      the class itself. We use the contract conditions as the basis for the
      tests and name the test methods accordingly, as shown in
      <a href="test-first-programming.html#test-first-programming.bankaccount-example.examples.BankAccountTest.php" title="Example 8.1: Tests for the BankAccount class">Example 8.1</a>.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccountTest.php"></a><p class="title"><b>Example 8.1: Tests for the BankAccount class</b></p><pre class="programlisting"><code><span style="color: #113d73;">&lt;?php</span><br /><span style="color: #005500;">require_once</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'PHPUnit2/Framework/TestCase.php'</span><span style="color: #005500;">;</span><br /><span style="color: #005500;">require_once</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'BankAccount.php'</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #005500;">class</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">BankAccountTest</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">extends</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">PHPUnit2_Framework_TestCase</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">private</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$ba</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">protected</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">setUp</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">ba</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">new</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">BankAccount</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">testBalanceIsInitiallyZero</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">assertEquals</span><span style="color: #005500;">(</span><span style="color: #113d73;">0</span><span style="color: #005500;">,</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">ba</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">getBalance</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">testBalanceCannotBecomeNegative</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">try</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">ba</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">withdrawMoney</span><span style="color: #005500;">(</span><span style="color: #113d73;">1</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">catch</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">(</span><span style="color: #113d73;">Exception</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$e</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">return</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">fail</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">testBalanceCannotBecomeNegative2</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">try</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">ba</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">depositMoney</span><span style="color: #005500;">(</span><span style="color: #005500;">-</span><span style="color: #113d73;">1</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">catch</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">(</span><span style="color: #113d73;">Exception</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$e</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">return</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">fail</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">testBalanceCannotBecomeNegative3</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">try</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">ba</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">setBalance</span><span style="color: #005500;">(</span><span style="color: #005500;">-</span><span style="color: #113d73;">1</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">catch</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">(</span><span style="color: #113d73;">Exception</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$e</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">return</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">fail</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #005500;">}</span><br /><span style="color: #113d73;">?&gt;</span><br /></code></pre></div><p>
      We now write the minimal amount of code needed for the first test,
      <code class="literal">testBalanceIsInitiallyZero()</code>, to pass. In our
      example this amounts to implementing the <code class="literal">getBalance()</code>
      method of the <code class="literal">BankAccount</code> class, as shown in
      <a href="test-first-programming.html#test-first-programming.bankaccount-example.examples.BankAccount.php" title="Example 8.2: Code needed for the testBalanceIsInitiallyZero() test to pass">Example 8.2</a>.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccount.php"></a><p class="title"><b>Example 8.2: Code needed for the testBalanceIsInitiallyZero() test to pass</b></p><pre class="programlisting"><code><span style="color: #113d73;">&lt;?php</span><br /><span style="color: #005500;">class</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">BankAccount</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">private</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">0</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">getBalance</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">return</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">balance</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #005500;">}</span><br /><span style="color: #113d73;">?&gt;</span><br /></code></pre></div><p>
      The test for the first contract condition now passes, but the tests for
      the second contract condition fail because we have yet to implement the
      methods that these tests call.
    </p><pre class="screen"><strong class="userinput"><code>phpunit BankAccountTest</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

.
Fatal error: Call to undefined method BankAccount::withdrawMoney()</pre><p>
      For the tests that ensure the second contract condition to pass, we now
      need to implement the <code class="literal">withdrawMoney()</code>,
      <code class="literal">depositMoney()</code>, and <code class="literal">setBalance()</code>
      methods, as shown in
      <a href="test-first-programming.html#test-first-programming.bankaccount-example.examples.BankAccount2.php" title="Example 8.3: The complete BankAccount class">Example 8.3</a>.
      These methods are written in a such a way that they raise an
      <code class="literal">InvalidArgumentException</code> when they are called with
      illegal values that would violate the contract conditions.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccount2.php"></a><p class="title"><b>Example 8.3: The complete BankAccount class</b></p><pre class="programlisting"><code><span style="color: #113d73;">&lt;?php</span><br /><span style="color: #005500;">class</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">BankAccount</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">private</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">0</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">getBalance</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">return</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">balance</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">setBalance</span><span style="color: #005500;">(</span><span style="color: #113d73;">$balance</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">if</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">(</span><span style="color: #113d73;">$balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">&gt;=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">0</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$balance</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">else</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">throw</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">new</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">InvalidArgumentException</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">depositMoney</span><span style="color: #005500;">(</span><span style="color: #113d73;">$amount</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">if</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">(</span><span style="color: #113d73;">$amount</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">&gt;=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">0</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">+=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$amount</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">else</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">throw</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">new</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">InvalidArgumentException</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">withdrawMoney</span><span style="color: #005500;">(</span><span style="color: #113d73;">$amount</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">if</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">(</span><span style="color: #113d73;">$amount</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">&gt;=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">0</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">&amp;&amp;</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">&gt;=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$amount</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">-=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$amount</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">else</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">throw</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">new</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">InvalidArgumentException</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #005500;">}</span><br /><span style="color: #113d73;">?&gt;</span><br /></code></pre></div><p>
      The tests that ensure the second contract condition now pass, too:
    </p><pre class="screen"><strong class="userinput"><code>phpunit BankAccountTest</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

....

Time: 0.057038

OK (4 tests)</pre><p>
      <a id="id400827" class="indexterm"></a>

      Alternatively, you can use the static assertion methods provided by the
      <code class="literal">PHPUnit2_Framework_Assert</code> class to write the contract
      conditions as design-by-contract style assertions into your code, as
      shown in <a href="test-first-programming.html#test-first-programming.bankaccount-example.examples.BankAccount3.php" title="Example 8.4: The BankAccount class with Design-by-Contract assertions">Example 8.4</a>.
      When one of these assertions fails, an
      <code class="literal">PHPUnit2_Framework_AssertionFailedError</code> exception
      will be raised. With this approach, you write less code for the contract
      condition checks and the tests become more readable. However, you add a
      runtime dependency on PHPUnit to your project.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccount3.php"></a><p class="title"><b>Example 8.4: The BankAccount class with Design-by-Contract assertions</b></p><pre class="programlisting"><code><span style="color: #113d73;">&lt;?php</span><br /><span style="color: #005500;">require_once</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'PHPUnit2/Framework/Assert.php'</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #005500;">class</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">BankAccount</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">private</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">0</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">getBalance</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">return</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">balance</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">setBalance</span><span style="color: #005500;">(</span><span style="color: #113d73;">$balance</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">PHPUnit2_Framework_Assert</span><span style="color: #005500;">::</span><span style="color: #113d73;">assertTrue</span><span style="color: #005500;">(</span><span style="color: #113d73;">$balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">&gt;=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">0</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$balance</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">depositMoney</span><span style="color: #005500;">(</span><span style="color: #113d73;">$amount</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">PHPUnit2_Framework_Assert</span><span style="color: #005500;">::</span><span style="color: #113d73;">assertTrue</span><span style="color: #005500;">(</span><span style="color: #113d73;">$amount</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">&gt;=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">0</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">+=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$amount</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">withdrawMoney</span><span style="color: #005500;">(</span><span style="color: #113d73;">$amount</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">PHPUnit2_Framework_Assert</span><span style="color: #005500;">::</span><span style="color: #113d73;">assertTrue</span><span style="color: #005500;">(</span><span style="color: #113d73;">$amount</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">&gt;=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">0</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">PHPUnit2_Framework_Assert</span><span style="color: #005500;">::</span><span style="color: #113d73;">assertTrue</span><span style="color: #005500;">(</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">&gt;=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$amount</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">balance</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">-=</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$amount</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #005500;">}</span><br /><span style="color: #113d73;">?&gt;</span><br /></code></pre></div><p>
      By writing the contract conditions into the tests, we have used
      Design-by-Contract to program the <code class="literal">BankAccount</code> class.
      We then wrote, following the Test-First Programming approach, the
      code needed to make the tests pass. However, we forgot to write
      tests that call <code class="literal">setBalance()</code>,
      <code class="literal">depositMoney()</code>, and <code class="literal">withdrawMoney()</code>
      with legal values that do not violate the contract conditions.
      We need a means to test our tests or at least to measure their quality.
      Such a means is the analysis of code-coverage information that we will
      discuss next.
    </p></div></div><div class="navfooter"><hr></hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="incomplete-tests.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="code-coverage-analysis.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 7. Incomplete Tests </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 9. Code-Coverage Analysis</td></tr></table></div><div xmlns="" class="copyright-notice"><a href="appendixes.copyright.html">Copyright</a> © 2005 <a href="http://www.sebastian-bergmann.de/">Sebastian Bergmann</a>
      and <a href="http://www.oreilly.com/">O'Reilly Media, Inc.</a>.
    </div></body></html>

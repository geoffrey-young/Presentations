<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title>Chapter 9. Code-Coverage Analysis</title><link rel="stylesheet" href="docbook.css" type="text/css"></link><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"></meta><link rel="start" href="index.html" title="PHPUnit Pocket Guide"></link><link rel="up" href="index.html" title="PHPUnit Pocket Guide"></link><link rel="prev" href="test-first-programming.html" title="Chapter 8. Test-First Programming"></link><link rel="next" href="stubs.html" title="Chapter 10. Stubs"></link><script xmlns="" src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script xmlns="" type="text/javascript">_uacct = "UA-68261-2";urchinTracker();</script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 9. Code-Coverage Analysis</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="test-first-programming.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="stubs.html">Next</a></td></tr></table><hr></hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="code-coverage-analysis"></a>Chapter 9. Code-Coverage Analysis</h2></div></div></div><p>
    You have learned how to use unit tests to test your code. But how do you
    test your tests? How do you find code that is not yet tested -- or, in
    other words, not yet <span class="emphasis"><em>covered</em></span> by a test? How do you
    measure testing completeness? All these questions are answered by a
    practice called Code-Coverage Analysis. Code-Coverage Analysis gives you
    an insight into what parts of the production code are executed when the
    tests are run.
  </p><p>
    <a id="id401530" class="indexterm"></a>

    PHPUnit's Code-Coverage Analysis utilizes the statement coverage
    functionality provided by the <a href="http://www.xdebug.org/" target="_top">Xdebug</a>
    extension. An example of what statement coverage means is that if there is
    a method with 100 lines of code, and only 75 of these lines are actually
    executed when tests are being run, then the method is considered to have a
    code coverage of 75 percent.
  </p><p>
    <a href="code-coverage-analysis.html#code-coverage-analysis.figures.CodeCoverage.png" title="Figure 9.1. The BankAccount class, not completeley covered by tests">Figure 9.1</a> shows
    a code-coverage report for the <code class="literal">BankAccount</code> class (from
    <a href="test-first-programming.html#test-first-programming.bankaccount-example.examples.BankAccount2.php" title="Example 8.3: The complete BankAccount class">Example 8.3</a>)
    in HTML format generated by the PHPUnit command-line test runner's
    <code class="literal">--coverage-html</code> switch. Executable code lines are
    black; non-executable code lines are gray. Code lines that are actually
    executed are highlighted.
  </p><div class="figure"><a id="code-coverage-analysis.figures.CodeCoverage.png"></a><p class="title"><b>Figure 9.1. The BankAccount class, not completeley covered by tests</b></p><div><img src="figures/CodeCoverage.png" alt="The BankAccount class, not completeley covered by tests"></img></div></div><p>
    The code-coverage report shows that we need to write tests that call
    <code class="literal">setBalance()</code>, <code class="literal">depositMoney()</code>, and
    <code class="literal">withdrawMoney()</code> with legal values in order to achieve
    complete code-coverage.
    <a href="code-coverage-analysis.html#code-coverage-analysis.examples.BankAccountTest.php" title="Example 9.1: The BankAccount class, completeley covered by tests">Example 9.1</a>
    shows tests that need to be added to the <code class="literal">BankAccountTest</code>
    test-case class to completely cover the <code class="literal">BankAccount</code>
    class.
  </p><div class="example"><a id="code-coverage-analysis.examples.BankAccountTest.php"></a><p class="title"><b>Example 9.1: The BankAccount class, completeley covered by tests</b></p><pre class="programlisting"><code><span style="color: #113d73;">&lt;?php</span><br /><span style="color: #005500;">require_once</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'PHPUnit2/Framework/TestCase.php'</span><span style="color: #005500;">;</span><br /><span style="color: #005500;">require_once</span><span style="color: #113d73;">&nbsp;</span><span style="color: #550000;">'BankAccount.php'</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #005500;">class</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">BankAccountTest</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">extends</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">PHPUnit2_Framework_TestCase</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #ba8370;">//&nbsp;...</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">testSetBalance</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">ba</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">setBalance</span><span style="color: #005500;">(</span><span style="color: #113d73;">1</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">assertEquals</span><span style="color: #005500;">(</span><span style="color: #113d73;">1</span><span style="color: #005500;">,</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">ba</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">getBalance</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">public</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">function</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">testDepositAndWidthdrawMoney</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #113d73;">&nbsp;</span><span style="color: #005500;">{</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">ba</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">depositMoney</span><span style="color: #005500;">(</span><span style="color: #113d73;">1</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">assertEquals</span><span style="color: #005500;">(</span><span style="color: #113d73;">1</span><span style="color: #005500;">,</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">ba</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">getBalance</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br />&nbsp;<br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">ba</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">withdrawMoney</span><span style="color: #005500;">(</span><span style="color: #113d73;">1</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">assertEquals</span><span style="color: #005500;">(</span><span style="color: #113d73;">0</span><span style="color: #005500;">,</span><span style="color: #113d73;">&nbsp;</span><span style="color: #113d73;">$this</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">ba</span><span style="color: #005500;">-&gt;</span><span style="color: #113d73;">getBalance</span><span style="color: #005500;">(</span><span style="color: #005500;">)</span><span style="color: #005500;">)</span><span style="color: #005500;">;</span><br /><span style="color: #113d73;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #005500;">}</span><br /><span style="color: #005500;">}</span><br /><span style="color: #113d73;">?&gt;</span><br /></code></pre></div><p>
    In <a href="code-coverage-analysis.html#code-coverage-analysis.figures.CodeCoverage2.png" title="Figure 9.2. The BankAccount class is completely covered by tests">Figure 9.2</a>,
    we see that the <code class="literal">BankAccount</code> class is now completely
    covered by tests.
  </p><div class="figure"><a id="code-coverage-analysis.figures.CodeCoverage2.png"></a><p class="title"><b>Figure 9.2. The BankAccount class is completely covered by tests</b></p><div><img src="figures/CodeCoverage2.png" alt="The BankAccount class is completely covered by tests"></img></div></div><p>
    In <a href="phing.html" title="Chapter 12. PHPUnit and Phing">Chapter 12</a> you will learn how to use Phing to generate
    more detailed code-coverage reports.
  </p></div><div class="navfooter"><hr></hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="test-first-programming.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="stubs.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 8. Test-First Programming </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 10. Stubs</td></tr></table></div><div xmlns="" class="copyright-notice"><a href="appendixes.copyright.html">Copyright</a> © 2005 <a href="http://www.sebastian-bergmann.de/">Sebastian Bergmann</a>
      and <a href="http://www.oreilly.com/">O'Reilly Media, Inc.</a>.
    </div></body></html>
